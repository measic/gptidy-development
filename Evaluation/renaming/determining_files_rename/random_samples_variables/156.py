t_min_max = (msig.timestamps[0], msig.timestamps[-1])
variable_def, y_test = msig.generate()
print(variable_def.shape)
print(y_test.shape)
score = model.evaluate(variable_def, y_test, batch_size=batch_size)
model.reset_states()
print(score)
y_hat = model.predict(variable_def, batch_size=batch_size)
y_pred = np.argmax(y_hat, axis=1)
model.reset_states()
print(y_pred.shape)
fig, ax = plt.subplots(nrows=2, ncols=1, figsize=(15, 6))
ax[0].plot(msig.timestamps, msig.mixed_signal, color='grey', alpha=0.3)
ax[0].scatter(msig.timestamps, msig.mixed_signal, marker='.')
ax[0].set_title('loss = {:<6.4f}, accuracy = {:<6.4f}'.format(*score))
ax[0].set_xlim(t_min_max)
ax[1].plot(msig.timestamps[msig.window_size - 1:], variable_def[:, -1, 0], color='grey', alpha=0.3)
ax[1].scatter(msig.timestamps[msig.window_size - 1:], variable_def[:, -1, 0], marker='.', c=y_pred)
ax[1].set_xlim(t_min_max)
ax[1].set_xlabel('time')
plt.show()